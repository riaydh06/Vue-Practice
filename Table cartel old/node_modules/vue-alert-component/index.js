import Vue from 'vue'
import AlertComponent from './alert.vue'

let instance;

let AlertConstructor = Vue.extend(AlertComponent);

let initInstance = () => {
  instance = new AlertConstructor({
    el: document.createElement('div')
  });
  document.body.appendChild(instance.$el);
}

let Alert = (content) => {
  initInstance();
  instance.content = content;
  return new Promise((resolve, reject) => {
    instance.show = true;

    // fix 弹窗出来之后依旧键盘没有回收
    let inputs = Array.prototype.slice.call(document.querySelectorAll('input'));
    //防止弹框出来 还能滚动
    document.getElementsByTagName("body")[0].style.overflow = "hidden"

    inputs.forEach((input) => {
      input.blur();
    });


    let success = instance.success;

    instance.success = () => {
      document.getElementsByTagName("body")[0].style.overflow = "visible"
      success();
      resolve('ok');
    }
  });
}
export default {
  install (Vue) {
    Vue.prototype.$alert = Alert;
  }
};
